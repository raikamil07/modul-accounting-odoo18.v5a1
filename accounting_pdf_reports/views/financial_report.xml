<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Form View -->
        <record id="view_account_financial_report_form" model="ir.ui.view">
            <field name="name">account.financial.report.form</field>
            <field name="model">account.financial.report</field>
            <field name="arch" type="xml">
                <form string="Account Report">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name" placeholder="Report Name"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="parent_id" options="{'no_create': True}"/>
                                <field name="sequence"/>
                            </group>
                            <group>
                                <field name="type" widget="radio"/>
                                <field name="sign" widget="radio"/>
                                <field name="style_overwrite"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Report Configuration" 
                                  invisible="type not in ['accounts', 'account_type', 'account_report']">
                                <group>
                                    <field name="display_detail" 
                                           invisible="type not in ['accounts', 'account_type', 'account_report']"/>
                                    <field name="account_report_id" 
                                           invisible="type != 'account_report'"
                                           options="{'no_create': True}"/>
                                </group>
                                <separator string="Accounts" invisible="type != 'accounts'"/>
                                <field name="account_ids" 
                                       invisible="type != 'accounts'"
                                       widget="many2many_tags"
                                       options="{'no_create': True}"/>
                                
                                <separator string="Account Types" invisible="type != 'account_type'"/>
                                <field name="account_type_ids" 
                                       invisible="type != 'account_type'"
                                       widget="many2many_tags"/>
                            </page>
                            <page string="Child Reports">
                                <field name="children_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="name"/>
                                        <field name="type"/>
                                        <field name="sign"/>
                                        <field name="display_detail"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree View -->
        <record id="view_account_financial_report_tree" model="ir.ui.view">
            <field name="name">account.financial.report.list</field>
            <field name="model">account.financial.report</field>
            <field name="arch" type="xml">
                <list string="Financial Reports" multi_edit="1">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="parent_id" optional="hide"/>
                    <field name="type"/>
                    <field name="sign" optional="hide"/>
                    <field name="account_report_id" optional="hide"/>
                    <field name="display_detail" optional="hide"/>
                </list>
            </field>
        </record>

        <!-- Search View -->
        <record id="view_account_financial_report_search" model="ir.ui.view">
            <field name="name">account.financial.report.search</field>
            <field name="model">account.financial.report</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="type"/>
                    <field name="account_report_id"/>
                    <filter string="Parent Reports" name="filter_parent_reports" domain="[('parent_id','=', False)]"/>
                    <filter string="Accounts" name="filter_accounts" domain="[('type','=','accounts')]"/>
                    <filter string="Account Type" name="filter_account_type" domain="[('type','=','account_type')]"/>
                    <filter string="Sum Type" name="filter_sum_type" domain="[('type','=','sum')]"/>
                    <filter string="Parent Report" name="group_by_parent" context="{'group_by':'parent_id'}"/>
                    <filter string="Report Type" name="group_by_type" context="{'group_by':'type'}"/>
                    <filter string="Sign" name="group_by_sign" context="{'group_by':'sign'}"/>
                </search>
            </field>
        </record>

        <!-- Kanban View -->
        <record id="view_account_financial_report_kanban" model="ir.ui.view">
            <field name="name">account.financial.report.kanban</field>
            <field name="model">account.financial.report</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <span class="fa fa-bars text-muted" title="Options"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="type"/>
                                    <t t-if="record.parent_id.value">
                                        <br/>Parent: <field name="parent_id"/>
                                    </t>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Action -->
        <record id="action_account_financial_report_tree" model="ir.actions.act_window">
            <field name="name">Financial Reports</field>
            <field name="res_model">account.financial.report</field>
            <field name="view_mode">list,form,kanban</field>
            <field name="context">{'search_default_filter_parent_reports': 1}</field>
            <field name="search_view_id" ref="view_account_financial_report_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first Financial Report!
                </p>
                <p>
                    Financial Reports allow you to define custom reports for your accounting needs.
                    You can create hierarchical structures and define how accounts should be grouped and calculated.
                </p>
            </field>
        </record>

        <!-- Menu Structure -->
        <menuitem id="menu_finance_reports_settings"
                  name="Financial Reports"
                  sequence="90"
                  groups="account.group_account_manager"
                  parent="account.menu_finance_configuration"/>

        <menuitem id="menu_account_financial_reports"
                  name="Financial Reports"
                  action="action_account_financial_report_tree"
                  sequence="10"
                  groups="account.group_account_user,account.group_account_manager"
                  parent="menu_finance_reports_settings"/>

    </data>
</odoo>
